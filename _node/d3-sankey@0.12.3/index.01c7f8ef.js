import{min as W,sum as H,max as q}from"../d3-array@2.12.1/index.62e7d53a.js";import{linkHorizontal as tn}from"../d3-shape@1.3.7/index.83d6a97d.js";function on(i){return i.target.depth}function en(i){return i.depth}function rn(i,u){return u-1-i.height}function B(i,u){return i.sourceLinks.length?i.depth:u-1}function sn(i){return i.targetLinks.length?i.depth:i.sourceLinks.length?W(i.sourceLinks,on)-1:0}function v(i){return function(){return i}}function D(i,u){return M(i.source,u.source)||i.index-u.index}function F(i,u){return M(i.target,u.target)||i.index-u.index}function M(i,u){return i.y0-u.y0}function V(i){return i.value}function un(i){return i.index}function fn(i){return i.nodes}function cn(i){return i.links}function G(i,u){const l=i.get(u);if(!l)throw new Error("missing: "+u);return l}function K({nodes:i}){for(const u of i){let l=u.y0,h=l;for(const g of u.sourceLinks)g.y0=l+g.width/2,l+=g.width;for(const g of u.targetLinks)g.y1=h+g.width/2,h+=g.width}}function an(){let i=0,u=0,l=1,h=1,g=24,S=8,a,b=un,z=B,k,d,j=fn,E=cn,x=6;function f(){const n={nodes:j.apply(null,arguments),links:E.apply(null,arguments)};return N(n),O(n),Q(n),R(n),X(n),K(n),n}f.update=function(n){return K(n),n},f.nodeId=function(n){return arguments.length?(b=typeof n=="function"?n:v(n),f):b},f.nodeAlign=function(n){return arguments.length?(z=typeof n=="function"?n:v(n),f):z},f.nodeSort=function(n){return arguments.length?(k=n,f):k},f.nodeWidth=function(n){return arguments.length?(g=+n,f):g},f.nodePadding=function(n){return arguments.length?(S=a=+n,f):S},f.nodes=function(n){return arguments.length?(j=typeof n=="function"?n:v(n),f):j},f.links=function(n){return arguments.length?(E=typeof n=="function"?n:v(n),f):E},f.linkSort=function(n){return arguments.length?(d=n,f):d},f.size=function(n){return arguments.length?(i=u=0,l=+n[0],h=+n[1],f):[l-i,h-u]},f.extent=function(n){return arguments.length?(i=+n[0][0],l=+n[1][0],u=+n[0][1],h=+n[1][1],f):[[i,u],[l,h]]},f.iterations=function(n){return arguments.length?(x=+n,f):x};function N({nodes:n,links:r}){for(const[e,t]of n.entries())t.index=e,t.sourceLinks=[],t.targetLinks=[];const o=new Map(n.map((e,t)=>[b(e,t,n),e]));for(const[e,t]of r.entries()){t.index=e;let{source:s,target:c}=t;typeof s!="object"&&(s=t.source=G(o,s)),typeof c!="object"&&(c=t.target=G(o,c)),s.sourceLinks.push(t),c.targetLinks.push(t)}if(d!=null)for(const{sourceLinks:e,targetLinks:t}of n)e.sort(d),t.sort(d)}function O({nodes:n}){for(const r of n)r.value=r.fixedValue===void 0?Math.max(H(r.sourceLinks,V),H(r.targetLinks,V)):r.fixedValue}function Q({nodes:n}){const r=n.length;let o=new Set(n),e=new Set,t=0;for(;o.size;){for(const s of o){s.depth=t;for(const{target:c}of s.sourceLinks)e.add(c)}if(++t>r)throw new Error("circular link");o=e,e=new Set}}function R({nodes:n}){const r=n.length;let o=new Set(n),e=new Set,t=0;for(;o.size;){for(const s of o){s.height=t;for(const{source:c}of s.targetLinks)e.add(c)}if(++t>r)throw new Error("circular link");o=e,e=new Set}}function T({nodes:n}){const r=q(n,t=>t.depth)+1,o=(l-i-g)/(r-1),e=new Array(r);for(const t of n){const s=Math.max(0,Math.min(r-1,Math.floor(z.call(null,t,r))));t.layer=s,t.x0=i+s*o,t.x1=t.x0+g,e[s]?e[s].push(t):e[s]=[t]}if(k)for(const t of e)t.sort(k);return e}function U(n){const r=W(n,o=>(h-u-(o.length-1)*a)/H(o,V));for(const o of n){let e=u;for(const t of o){t.y0=e,t.y1=e+t.value*r,e=t.y1+a;for(const s of t.sourceLinks)s.width=s.value*r}e=(h-e+a)/(o.length+1);for(let t=0;t<o.length;++t){const s=o[t];s.y0+=e*(t+1),s.y1+=e*(t+1)}_(o)}}function X(n){const r=T(n);a=Math.min(S,(h-u)/(q(r,o=>o.length)-1)),U(r);for(let o=0;o<x;++o){const e=Math.pow(.99,o),t=Math.max(1-e,(o+1)/x);Z(r,e,t),Y(r,e,t)}}function Y(n,r,o){for(let e=1,t=n.length;e<t;++e){const s=n[e];for(const c of s){let L=0,y=0;for(const{source:p,value:A}of c.targetLinks){let w=A*(c.layer-p.layer);L+=$(p,c)*w,y+=w}if(!(y>0))continue;let m=(L/y-c.y0)*r;c.y0+=m,c.y1+=m,P(c)}k===void 0&&s.sort(M),C(s,o)}}function Z(n,r,o){for(let e=n.length,t=e-2;t>=0;--t){const s=n[t];for(const c of s){let L=0,y=0;for(const{target:p,value:A}of c.sourceLinks){let w=A*(p.layer-c.layer);L+=nn(c,p)*w,y+=w}if(!(y>0))continue;let m=(L/y-c.y0)*r;c.y0+=m,c.y1+=m,P(c)}k===void 0&&s.sort(M),C(s,o)}}function C(n,r){const o=n.length>>1,e=n[o];J(n,e.y0-a,o-1,r),I(n,e.y1+a,o+1,r),J(n,h,n.length-1,r),I(n,u,0,r)}function I(n,r,o,e){for(;o<n.length;++o){const t=n[o],s=(r-t.y0)*e;s>1e-6&&(t.y0+=s,t.y1+=s),r=t.y1+a}}function J(n,r,o,e){for(;o>=0;--o){const t=n[o],s=(t.y1-r)*e;s>1e-6&&(t.y0-=s,t.y1-=s),r=t.y0-a}}function P({sourceLinks:n,targetLinks:r}){if(d===void 0){for(const{source:{sourceLinks:o}}of r)o.sort(F);for(const{target:{targetLinks:o}}of n)o.sort(D)}}function _(n){if(d===void 0)for(const{sourceLinks:r,targetLinks:o}of n)r.sort(F),o.sort(D)}function $(n,r){let o=n.y0-(n.sourceLinks.length-1)*a/2;for(const{target:e,width:t}of n.sourceLinks){if(e===r)break;o+=t+a}for(const{source:e,width:t}of r.targetLinks){if(e===n)break;o-=t}return o}function nn(n,r){let o=r.y0-(r.targetLinks.length-1)*a/2;for(const{source:e,width:t}of r.targetLinks){if(e===n)break;o+=t+a}for(const{target:e,width:t}of n.sourceLinks){if(e===r)break;o-=t}return o}return f}function ln(i){return[i.source.x1,i.y0]}function gn(i){return[i.target.x0,i.y1]}function hn(){return tn().source(ln).target(gn)}export{an as sankey,sn as sankeyCenter,B as sankeyJustify,en as sankeyLeft,hn as sankeyLinkHorizontal,rn as sankeyRight};
